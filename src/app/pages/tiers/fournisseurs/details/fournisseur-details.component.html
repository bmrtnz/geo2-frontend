<form [formGroup]="fournisseurForm" (ngSubmit)="onSubmit()">
  <div class="content-block">
    <h2>
      {{ 'tiers-fournisseurs-details-title' | localize }}
      <div class="right">
        <dx-button class="upperButton"
          type="default"
          text="{{ 'btn-valider' | localize }}"
          [visible]="!readOnlyMode"
          [useSubmitBehavior]="true"
        ></dx-button>
        <dx-button class="upperButton"
          type="default"
          text="{{ 'btn-editer' | localize }}"
          [visible]="readOnlyMode"
          (onClick)="readOnlyMode = !readOnlyMode"
        ></dx-button>
        <dx-button class="upperButton"
          type="normal"
          text="{{ 'btn-annuler' | localize }}"
          [visible]="!readOnlyMode"
          (onClick)="onCancel()"
        ></dx-button>
      </div>
    </h2>
  </div>

  <div class="content-block fournisseur-page">
    <dx-box direction="row">
      <dxi-item [ratio]="1">
        <h4 class="entity-id">N° {{ fournisseur?.id }}</h4>
        <dx-button
          height="auto"
          type="danger"
          icon="material-icons person"
          text="{{ 'tiers-fournisseurs-contacts' | localize }}"
          (onClick)="contactsBtnClick()">
        </dx-button>
        <!--<dx-button
          height="auto"
          type="default"
          icon="material-icons home_work"
          text="{{ 'tiers-fournisseurs-partenaires' | localize }}">
        </dx-button>-->

        <dx-check-box
          class="vertical"
          formControlName="valide"
          [text]="fournisseurForm.get('valide') ? 'valide' : 'invalide' | localize"
        ></dx-check-box>
        <app-historique-valide [historique]="fournisseur?.historique"></app-historique-valide>
        <dx-button
          class="black"
          height="auto"
          icon="material-icons folder"
          text="{{ 'btn-docsjoints' | localize }}">
        </dx-button>
      </dxi-item>
      <dxi-item [ratio]="0.3">
      </dxi-item>
      <dxi-item [ratio]="4">
        <div class="dx-form-group dx-form-group-with-caption dx-card responsive-paddings">
          <span class="dx-form-group-caption">{{ 'tiers-fournisseurs-details-groupe-infos' | localize }}</span>

          <div class="dx-form-group-content">
            <!-- Code -->
            <div class="dx-field">
              <div class="dx-field-label">{{ 'tiers-fournisseurs-code' | localize }}</div>
              <div class="dx-field-value">
                <dx-text-box formControlName="id" [readOnly]="true">
                  <dx-validator name="{{ 'tiers-fournisseurs-code' | localize }}">
                    <dxi-validation-rule type="required"></dxi-validation-rule>
                    <dxi-validation-rule type="stringLength" max="12"></dxi-validation-rule>
                  </dx-validator>
                </dx-text-box>
              </div>
            </div>

            <!-- Stock actif -->
            <div class="dx-field">
              <div class="dx-field-label">{{ 'tiers-fournisseurs-stockActif' | localize }}</div>
              <div class="dx-field-value">
                <dx-check-box
                  formControlName="stockActif"
                  [readOnly]="readOnlyMode"
                ></dx-check-box>
              </div>
            </div>

            <!-- Suivi précalibré -->
            <div class="dx-field">
              <div class="dx-field-label">{{ 'tiers-fournisseurs-stockPrecalibre' | localize }}</div>
              <div class="dx-field-value">
                <dx-check-box
                  formControlName="stockPrecalibre"
                  [readOnly]="readOnlyMode"
                ></dx-check-box>
              </div>
            </div>

          </div>
        </div>

        <div class="dx-form-group dx-form-group-with-caption dx-card responsive-paddings">
          <span class="dx-form-group-caption">{{ 'tiers-fournisseurs-details-groupe-adresses' | localize }}</span>

          <div class="dx-form-group-content">
            <!-- Raison social -->
            <div class="dx-field">
              <div class="dx-field-label">{{ 'tiers-fournisseurs-raisonSocial' | localize }}</div>
              <div class="dx-field-value">
                <dx-text-box formControlName="raisonSocial" [readOnly]="readOnlyMode">
                  <dx-validator name="{{ 'tiers-fournisseurs-raisonSocial' | localize }}">
                    <dxi-validation-rule type="required"></dxi-validation-rule>
                 </dx-validator>
                </dx-text-box>
              </div>
            </div>

            <!-- Adresse 1 -->
            <div class="dx-field">
              <div class="dx-field-label">{{ 'tiers-fournisseurs-adresse1' | localize }}</div>
              <div class="dx-field-value">
                <dx-text-box formControlName="adresse1" [readOnly]="readOnlyMode">
                  <dx-validator name="{{ 'tiers-fournisseurs-adresse1' | localize }}">
                    <dxi-validation-rule type="stringLength" max="70"></dxi-validation-rule>
                    <dxi-validation-rule type="required"></dxi-validation-rule>
                  </dx-validator>
                </dx-text-box>
              </div>
            </div>

            <!-- Adresse 2 -->
            <div class="dx-field">
              <div class="dx-field-label">{{ 'tiers-fournisseurs-adresse2' | localize }}</div>
              <div class="dx-field-value">
                <dx-text-box formControlName="adresse2" [readOnly]="readOnlyMode">
                  <dx-validator name="{{ 'tiers-fournisseurs-adresse2' | localize }}">
                    <dxi-validation-rule type="stringLength" max="70"></dxi-validation-rule>
                  </dx-validator>
                </dx-text-box>
              </div>
            </div>

            <!-- Adresse 3 -->
            <div class="dx-field">
              <div class="dx-field-label">{{ 'tiers-fournisseurs-adresse3' | localize }}</div>
              <div class="dx-field-value">
                <dx-text-box formControlName="adresse3" [readOnly]="readOnlyMode">
                  <dx-validator name="{{ 'tiers-fournisseurs-adresse3' | localize }}">
                    <dxi-validation-rule type="stringLength" max="70"></dxi-validation-rule>
                  </dx-validator>
                </dx-text-box>
              </div>
            </div>

            <!-- Code postal -->
            <div class="dx-field">
              <div class="dx-field-label">{{ 'tiers-fournisseurs-codePostal' | localize }}</div>
              <div class="dx-field-value">
                <dx-text-box formControlName="codePostal" [readOnly]="readOnlyMode">
                  <dx-validator name="{{ 'tiers-fournisseurs-codePostal' | localize }}">
                    <dxi-validation-rule type="required"></dxi-validation-rule>
                    <dxi-validation-rule type="stringLength" max="9"></dxi-validation-rule>
                  </dx-validator>
                </dx-text-box>
              </div>
            </div>

            <!-- Ville -->
            <div class="dx-field">
              <div class="dx-field-label">{{ 'tiers-fournisseurs-ville' | localize }}</div>
              <div class="dx-field-value">
                <dx-text-box formControlName="ville" [readOnly]="readOnlyMode">
                  <dx-validator name="{{ 'tiers-fournisseurs-ville' | localize }}">
                    <dxi-validation-rule type="required"></dxi-validation-rule>
                    <dxi-validation-rule type="stringLength" max="35"></dxi-validation-rule>
                  </dx-validator>
                </dx-text-box>
              </div>
            </div>

            <!-- Pays -->
            <div class="dx-field">
              <div class="dx-field-label">{{ 'tiers-fournisseurs-pays' | localize }}</div>
              <div class="dx-field-value">
                <dx-select-box
                  formControlName="pays"
                  [readOnly]="readOnlyMode"
                  [dataSource]="pays"
                  displayExpr="description"
                  [searchEnabled]="true"
                  [searchExpr]="['id','description']"
                >
                <dx-validator name="{{ 'tiers-fournisseurs-pays' | localize }}">
                  <dxi-validation-rule type="required"></dxi-validation-rule>
                </dx-validator>
              </dx-select-box>
              </div>
            </div>

            <!-- Latitude -->
            <div class="dx-field">
              <div class="dx-field-label">{{ 'tiers-fournisseurs-latitude' | localize }}</div>
              <div class="dx-field-value">
                <dx-text-box formControlName="latitude" [readOnly]="readOnlyMode">
                  <dx-validator name="{{ 'tiers-fournisseurs-latitude' | localize }}">
                    <dxi-validation-rule type="stringLength" max="15"></dxi-validation-rule>
                  </dx-validator>
                </dx-text-box>
              </div>
            </div>

            <!-- Longitude -->
            <div class="dx-field">
              <div class="dx-field-label">{{ 'tiers-fournisseurs-longitude' | localize }}</div>
              <div class="dx-field-value">
                <dx-text-box formControlName="longitude" [readOnly]="readOnlyMode">
                  <dx-validator name="{{ 'tiers-fournisseurs-longitude' | localize }}">
                    <dxi-validation-rule type="stringLength" max="15"></dxi-validation-rule>
                  </dx-validator>
                </dx-text-box>
              </div>
            </div>
          </div>
        </div>
      </dxi-item>
      <dxi-item [ratio]="0.2">
      </dxi-item>
      <dxi-item [ratio]="4">
        <div class="dx-form-group dx-form-group-with-caption dx-card responsive-paddings">
          <span class="dx-form-group-caption">{{ 'tiers-fournisseurs-details-groupe-references' | localize }}</span>

          <div class="dx-form-group-content">

            <!-- Bureau achat -->
            <div class="dx-field">
              <div class="dx-field-label">{{ 'tiers-fournisseurs-bureauAchat' | localize }}</div>
              <div class="dx-field-value">
                <dx-select-box
                formControlName="bureauAchat"
                [readOnly]="readOnlyMode"
                [dataSource]="bureauxAchat"
                displayExpr="raisonSocial"
                [searchEnabled]="true"
                [searchExpr]="['id','raisonSocial']"
                >
                <dx-validator name="{{ 'tiers-fournisseurs-bureauAchat' | localize }}">
                  <dxi-validation-rule type="required"></dxi-validation-rule>
                </dx-validator>
              </dx-select-box>
              </div>
            </div>

            <!-- Lieu fonction EAN -->
            <div class="dx-field">
              <div class="dx-field-label">{{ 'tiers-fournisseurs-lieuFonctionEan' | localize }}</div>
              <div class="dx-field-value">
                <dx-text-box formControlName="lieuFonctionEan" [readOnly]="readOnlyMode">
                  <dx-validator name="{{ 'tiers-fournisseurs-lieuFonctionEan' | localize }}">
                    <dxi-validation-rule type="stringLength" max="35"></dxi-validation-rule>
                  </dx-validator>
                </dx-text-box>
              </div>
            </div>

            <!-- Langue -->
            <div class="dx-field">
              <div class="dx-field-label">{{ 'tiers-fournisseurs-langue' | localize }}</div>
              <div class="dx-field-value">
                <dx-select-box
                  formControlName="langue"
                  [readOnly]="readOnlyMode"
                  [dataSource]="pays"
                  displayExpr="description"
                  [searchEnabled]="true"
                  [searchExpr]="['id','description']"
                >
                <dx-validator name="{{ 'tiers-fournisseurs-langue' | localize }}">
                  <dxi-validation-rule type="required"></dxi-validation-rule>
                </dx-validator>
              </dx-select-box>
              </div>
            </div>

            <!-- tvaCee -->
            <div class="dx-field">
              <div class="dx-field-label">{{ 'tiers-fournisseurs-tvaCee' | localize }}</div>
              <div class="dx-field-value">
                <dx-text-box formControlName="tvaCee" [readOnly]="readOnlyMode">
                  <dx-validator name="{{ 'tiers-fournisseurs-tvaCee' | localize }}">
                    <dxi-validation-rule type="required"></dxi-validation-rule>
                    <dxi-validation-rule type="stringLength" max="20"></dxi-validation-rule>
                  </dx-validator>
                </dx-text-box>
              </div>
            </div>

          </div>
          <dx-accordion
            [collapsible]="true"
            [multiple]="false"
            [selectedIndex]="-1"
          >
            <dxi-item title="{{ 'tiers-fournisseurs-indicationFacture' | localize }}">

              <!-- Type fournisseur -->
              <div class="dx-field">
                <div class="dx-field-label">{{ 'tiers-fournisseurs-typeFournisseur' | localize }}</div>
                <div class="dx-field-value">
                  <dx-select-box
                    formControlName="type"
                    [readOnly]="readOnlyMode"
                    [dataSource]="typesFournisseur"
                    displayExpr="description"
                    [searchEnabled]="true"
                    [searchExpr]="['id','description']"
                  ></dx-select-box>
                </div>
              </div>
              <!-- Compte comptable -->
              <div class="dx-field">
                <div class="dx-field-label">{{ 'tiers-fournisseurs-compteComptable' | localize }}</div>
                <div class="dx-field-value">
                  <dx-text-box formControlName="compteComptable" [readOnly]="readOnlyMode">
                    <dx-validator name="{{ 'tiers-fournisseurs-compteComptable' | localize }}">
                      <dxi-validation-rule type="stringLength" max="35"></dxi-validation-rule>
                    </dx-validator>
                  </dx-text-box>
                </div>
              </div>
              <!-- id tracabilité -->
              <div class="dx-field">
                <div class="dx-field-label">{{ 'tiers-fournisseurs-idTracabilite' | localize }}</div>
                <div class="dx-field-value">
                  <dx-text-box formControlName="idTracabilite" [readOnly]="readOnlyMode">
                    <dx-validator name="{{ 'tiers-fournisseurs-idTracabilite' | localize }}">
                      <dxi-validation-rule type="stringLength" max="35"></dxi-validation-rule>
                    </dx-validator>
                  </dx-text-box>
                </div>
              </div>

              <!-- Agrément BW -->
              <div class="dx-field">
                <div class="dx-field-label">{{ 'tiers-fournisseurs-agrementBW' | localize }}</div>
                <div class="dx-field-value">
                  <dx-text-box formControlName="agrementBW" [readOnly]="readOnlyMode">
                    <dx-validator name="{{ 'tiers-fournisseurs-agrementBW' | localize }}">
                      <dxi-validation-rule type="stringLength" max="35"></dxi-validation-rule>
                    </dx-validator>
                  </dx-text-box>
                </div>
              </div>
              <!-- Code station -->
              <div class="dx-field">
                <div class="dx-field-label">{{ 'tiers-fournisseurs-codeStation' | localize }}</div>
                <div class="dx-field-value">
                  <dx-text-box formControlName="codeStation" [readOnly]="readOnlyMode">
                    <dx-validator name="{{ 'tiers-fournisseurs-codeStation' | localize }}">
                      <dxi-validation-rule type="stringLength" max="35"></dxi-validation-rule>
                    </dx-validator>
                  </dx-text-box>
                </div>
              </div>
            </dxi-item>
          </dx-accordion>
        </div>

        <div class="dx-form-group dx-form-group-with-caption dx-card responsive-paddings">
          <span class="dx-form-group-caption">{{ 'tiers-fournisseurs-details-groupe-paiement' | localize }}</span>

          <div class="dx-form-group-content">
            <div class="dx-field">
              <dx-box direction="row">
                <dxi-item [ratio]="2">
                  <!-- Nb Jour Echeance -->
                  <div class="dx-field field-large">
                    <div class="dx-field-label">{{ 'tiers-fournisseurs-nbJourEcheance' | localize }}</div>
                    <div class="dx-field-value">
                      <dx-text-box formControlName="nbJourEcheance" [readOnly]="readOnlyMode">
                        <dx-validator name="{{ 'tiers-fournisseurs-nbJourEcheance' | localize }}">
                          <dxi-validation-rule type="required"></dxi-validation-rule>
                          <dxi-validation-rule type="numeric"></dxi-validation-rule>
                          <dxi-validation-rule type="stringLength" max="3"></dxi-validation-rule>
                        </dx-validator>
                      </dx-text-box>
                    </div>
                  </div>
                </dxi-item>
                <dxi-item [ratio]="1">
                  <!-- Echeance Le -->
                  <div class="dx-field field-small">
                    <div class="dx-field-label">{{ 'tiers-fournisseurs-echeanceLe' | localize }}</div>
                    <div class="dx-field-value">
                      <dx-text-box formControlName="echeanceLe" [readOnly]="readOnlyMode">
                          <dx-validator name="{{ 'tiers-fournisseurs-echeanceLe' | localize }}">
                            <dxi-validation-rule type="numeric"></dxi-validation-rule>
                            <dxi-validation-rule type="stringLength" max="2"></dxi-validation-rule>
                          </dx-validator>
                       </dx-text-box>
                    </div>
                  </div>
                </dxi-item>
              </dx-box>
            </div>

            <!-- Incoterm (Ne sert pas ?) -->
            <!-- <div class="dx-field">
              <div class="dx-field-label">{{ 'tiers-fournisseurs-incoterm' | localize }}</div>
              <div class="dx-field-value">
                <dx-text-box formControlName="incoterm"></dx-text-box>
              </div>
            </div> -->

            <!-- Regime Tva -->
            <div class="dx-field">
              <div class="dx-field-label">{{ 'tiers-fournisseurs-regimeTva' | localize }}</div>
              <div class="dx-field-value">
                <dx-select-box
                  formControlName="regimeTva"
                  [readOnly]="readOnlyMode"
                  [dataSource]="regimesTva"
                  displayExpr="description"
                  [searchEnabled]="true"
                  [searchExpr]="['id','description']"
                ></dx-select-box>
              </div>
            </div>

            <!-- Devise -->
            <div class="dx-field">
              <div class="dx-field-label">{{ 'tiers-fournisseurs-devise' | localize }}</div>
              <div class="dx-field-value">
                <dx-select-box
                  formControlName="devise"
                  [readOnly]="readOnlyMode"
                  [dataSource]="devises"
                  displayExpr="description"
                  [searchEnabled]="true"
                  [searchExpr]="['id','description']"
                >
                  <dx-validator name="{{ 'tiers-fournisseurs-devise' | localize }}">
                    <dxi-validation-rule type="required"></dxi-validation-rule>
                  </dx-validator>
                </dx-select-box>
              </div>
            </div>

            <!-- Moyen Paiement -->
            <div class="dx-field">
              <div class="dx-field-label">{{ 'tiers-fournisseurs-moyenPaiement' | localize }}</div>
              <div class="dx-field-value">
                <dx-select-box
                  formControlName="moyenPaiement"
                  [readOnly]="readOnlyMode"
                  [dataSource]="moyensPaiement"
                  displayExpr="description"
                  [searchEnabled]="true"
                  [searchExpr]="['id','description']"
                ></dx-select-box>
              </div>
            </div>

            <!-- Base Paiement -->
            <div class="dx-field">
              <div class="dx-field-label">{{ 'tiers-fournisseurs-basePaiement' | localize }}</div>
              <div class="dx-field-value">
                <dx-select-box
                  formControlName="basePaiement"
                  [readOnly]="readOnlyMode"
                  [dataSource]="basesPaiement"
                  displayExpr="description"
                  [searchEnabled]="true"
                  [searchExpr]="['id','description']"
                ></dx-select-box>
              </div>
            </div>

          </div>

          <dx-accordion
            [collapsible]="true"
            [multiple]="false"
            [selectedIndex]="-1"
          >
            <dxi-item title="{{ 'tiers-fournisseurs-autoFacturation' | localize }}">

              <!-- Auto facturation ? -->
              <div class="dx-field">
                <div class="dx-field-label">{{ 'tiers-fournisseurs-autoFacturation' | localize }} ?</div>
                <div class="dx-field-value">
                  <dx-check-box formControlName="autoFacturation" [readOnly]="readOnlyMode"></dx-check-box>
                </div>
              </div>
              <!-- Forme juridique -->
              <div class="dx-field">
                <div class="dx-field-label">{{ 'tiers-fournisseurs-formeJuridique' | localize }}</div>
                <div class="dx-field-value">
                  <dx-text-box formControlName="formeJuridique" [readOnly]="readOnlyMode">
                    <dx-validator name="{{ 'tiers-fournisseurs-formeJuridique' | localize }}">
                      <dxi-validation-rule type="stringLength" max="70"></dxi-validation-rule>
                    </dx-validator>
                  </dx-text-box>
                </div>
              </div>
              <!-- SIRET APE -->
              <div class="dx-field">
                <div class="dx-field-label">{{ 'tiers-fournisseurs-siretAPE' | localize }}</div>
                <div class="dx-field-value">
                  <dx-text-box formControlName="siretAPE" [readOnly]="readOnlyMode">
                    <dx-validator name="{{ 'tiers-fournisseurs-siretAPE' | localize }}">
                      <dxi-validation-rule type="numeric"></dxi-validation-rule>
                      <dxi-validation-rule type="stringLength" max="70"></dxi-validation-rule>
                    </dx-validator>
                  </dx-text-box>
                </div>
              </div>
              <!-- id TVA -->
              <div class="dx-field">
                <div class="dx-field-label">{{ 'tiers-fournisseurs-tvaId' | localize }}</div>
                <div class="dx-field-value">
                  <dx-text-box formControlName="tvaId" [readOnly]="readOnlyMode">
                    <dx-validator name="{{ 'tiers-fournisseurs-tvaId' | localize }}">
                      <dxi-validation-rule type="stringLength" max="70"></dxi-validation-rule>
                    </dx-validator>
                  </dx-text-box>
                </div>
              </div>
              <!-- RCS -->
              <div class="dx-field">
                <div class="dx-field-label">{{ 'tiers-fournisseurs-rcs' | localize }}</div>
                <div class="dx-field-value">
                  <dx-text-box formControlName="rcs" [readOnly]="readOnlyMode">
                    <dx-validator name="{{ 'tiers-fournisseurs-rcs' | localize }}">
                      <dxi-validation-rule type="stringLength" max="70"></dxi-validation-rule>
                    </dx-validator>
                  </dx-text-box>
                </div>
              </div>
            </dxi-item>
          </dx-accordion>

        </div>
      </dxi-item>
    </dx-box>
    <br>
    <dx-box direction="row">
      <dxi-item [ratio]="3">
        <div class="dx-form-group dx-form-group-with-caption dx-card responsive-paddings">
          <span class="dx-form-group-caption">{{ 'tiers-fournisseurs-details-groupe-certifications' | localize }}</span>
          <div class="dx-form-group-content">
            <!-- Certifications -->
            <div class="dx-field">
              <div class="dx-field-label">{{ 'tiers-clients-typeCertification' | localize }}</div>
              <div class="dx-field-value">
                  <dx-tag-box
                      [dataSource]="pays"
                      [readOnly]="readOnlyMode"
                      displayExpr="description"
                      placeholder="Sélectionner une ou plusieurs certifications..."
                      valueExpr="id">
                  </dx-tag-box>
              </div>
            </div>
          </div>
        </div>
      </dxi-item>
    </dx-box>
  </div>
</form>
