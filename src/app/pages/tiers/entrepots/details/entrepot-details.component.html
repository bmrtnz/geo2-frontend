<form [formGroup]="formGroup" (ngSubmit)="onSubmit()">

  <div class="content-block">
    <h2><span *ngIf="createMode === true">{{ 'create' | localize }}</span>
      {{ 'tiers-entrepots-details-title' | localize }}<span class="red-font"> {{ preSaisie | localize}}</span>
      <div class="right">
        <dx-button class="upperButton submit"
          type="default"
          text="{{ 'btn-valider' | localize }}"
          [visible]="!readOnlyMode"
          [useSubmitBehavior]="true"
        ></dx-button>
        <dx-button class="upperButton"
          type="default"
          text="{{ 'btn-editer' | localize }}"
          [visible]="readOnlyMode && !createMode"
          (onClick)="readOnlyMode = !readOnlyMode"
        ></dx-button>
        <dx-button class="upperButton"
          type="normal"
          text="{{ 'btn-annuler' | localize }}"
          [visible]="!readOnlyMode"
          (onClick)="onCancel()"
        ></dx-button>
      </div>
    </h2>
  </div>

  <div class="content-block entrepot-page">
    <dx-box direction="row">
      <dxi-item [ratio]="1"
      [visible]="!createMode"
      >
        <h4 class="entity-id">N°&nbsp;{{ entrepot?.id }}</h4>
        <dx-button
          height="auto"
          type="danger"
          icon="material-icons person"
          text="{{ 'tiers-entrepots-contacts' | localize }}"
          (onClick)="contactsBtnClick()">
        </dx-button>

        <dx-check-box
          class="vertical"
          formControlName="valide"
          [readOnly]="readOnlyMode"
          [text]="formGroup.get('valide') ? 'Valide' : 'Invalide' | localize"
        ></dx-check-box>
      </dxi-item>
      <dxi-item [ratio]="0.3">
      </dxi-item>
      <dxi-item [ratio]="4">
        <div class="dx-form-group dx-form-group-with-caption dx-card responsive-paddings">
          <span class="dx-form-group-caption">{{ 'tiers-entrepots-details-groupe-infos' | localize }}</span>

          <div class="dx-form-group-content">
            <!-- Code -->
            <div class="dx-field">
              <div class="dx-field-label">{{ 'tiers-entrepots-code' | localize }}</div>
              <div class="dx-field-value">
                <dx-text-box
                formControlName="code"
                [readOnly]="!createMode || mandatoryCode"
                [inputAttr]="{'style':  'text-transform: uppercase'}"
                >
                  <dx-validator name="{{ 'tiers-entrepots-code' | localize }}">
                    <dxi-validation-rule type="required"></dxi-validation-rule>
                    <dxi-validation-rule type="stringLength" max="18"></dxi-validation-rule>
                    <dxi-validation-rule *ngIf="createMode" type="async" message="Ce code est déjà utilisé" [validationCallback]="checkCode"></dxi-validation-rule>
                  </dx-validator>
                </dx-text-box>
              </div>
            </div>

            <!-- Commercial -->
            <div class="dx-field">
              <div class="dx-field-label">{{ 'tiers-entrepots-commercial' | localize }}</div>
              <div class="dx-field-value">
                <dx-select-box
                  formControlName="commercial"
                  [readOnly]="readOnlyMode"
                  [dataSource]="personnes"
                  displayExpr="nomUtilisateur"
                  [searchEnabled]="true"
                  [searchExpr]="['id','nomUtilisateur']"
                >
            	  <!-- <dx-validator name="{{ 'tiers-entrepots-commercial' | localize }}">
            	    <dxi-validation-rule type="required"></dxi-validation-rule>
                  </dx-validator> -->
                </dx-select-box>
              </div>
            </div>

            <!-- Assistante -->
            <div class="dx-field">
              <div class="dx-field-label">{{ 'tiers-entrepots-assistante' | localize }}</div>
              <div class="dx-field-value">
                <dx-select-box
                  formControlName="assistante"
                  [readOnly]="readOnlyMode"
                  [dataSource]="personnes"
                  displayExpr="nomUtilisateur"
                  [searchEnabled]="true"
                  [searchExpr]="['id','nomUtilisateur']"
                >
                </dx-select-box>
              </div>
            </div>

            <!-- Mode de livraion -->
            <div class="dx-field">
              <div class="dx-field-label">{{ 'tiers-entrepots-modeLivraison' | localize }}</div>
              <div class="dx-field-value">
                <dx-select-box
                  formControlName="modeLivraison"
                  [readOnly]="readOnlyMode"
                  [dataSource]="modesLivraison"
                ></dx-select-box>
              </div>
            </div>

          </div>
        </div>

        <div class="dx-form-group dx-form-group-with-caption dx-card responsive-paddings">
          <span class="dx-form-group-caption">{{ 'tiers-entrepots-details-groupe-adresses' | localize }}</span>

          <div class="dx-form-group-content">
            <!-- Raison sociale -->
            <div class="dx-field">
              <div class="dx-field-label">{{ 'tiers-entrepots-raisonSocial' | localize }}</div>
              <div class="dx-field-value">
                <dx-text-box formControlName="raisonSocial" [readOnly]="readOnlyMode">
                  <dx-validator name="{{ 'tiers-entrepots-raisonSocial' | localize }}">
                    <dxi-validation-rule type="required"></dxi-validation-rule>
                    <dxi-validation-rule type="stringLength" max="50"></dxi-validation-rule>
                  </dx-validator>
                </dx-text-box>
              </div>
            </div>

            <!-- Adresse 1 -->
            <div class="dx-field">
              <div class="dx-field-label">{{ 'tiers-entrepots-adresse1' | localize }}</div>
              <div class="dx-field-value">
                <dx-text-box formControlName="adresse1" [readOnly]="readOnlyMode">
                  <dx-validator name="{{ 'tiers-entrepots-adresse1' | localize }}">
                    <dxi-validation-rule type="required"></dxi-validation-rule>
                    <dxi-validation-rule type="stringLength" max="70"></dxi-validation-rule>
                  </dx-validator>
                </dx-text-box>
              </div>
            </div>

            <!-- Adresse 2 -->
            <div class="dx-field">
              <div class="dx-field-label">{{ 'tiers-entrepots-adresse2' | localize }}</div>
              <div class="dx-field-value">
                <dx-text-box formControlName="adresse2" [readOnly]="readOnlyMode">
                  <dx-validator name="{{ 'tiers-entrepots-adresse2' | localize }}">
                    <dxi-validation-rule type="stringLength" max="70"></dxi-validation-rule>
                  </dx-validator>
                </dx-text-box>
              </div>
            </div>

            <!-- Adresse 3 -->
            <div class="dx-field">
              <div class="dx-field-label">{{ 'tiers-entrepots-adresse3' | localize }}</div>
              <div class="dx-field-value">
                <dx-text-box formControlName="adresse3" [readOnly]="readOnlyMode">
                  <dx-validator name="{{ 'tiers-entrepots-adresse3' | localize }}">
                    <dxi-validation-rule type="stringLength" max="70"></dxi-validation-rule>
                  </dx-validator>
                </dx-text-box>
              </div>
            </div>

            <!-- Code postal -->
            <div class="dx-field">
              <div class="dx-field-label">{{ 'tiers-entrepots-codePostal' | localize }}</div>
              <div class="dx-field-value">
                <dx-text-box formControlName="codePostal" [readOnly]="readOnlyMode">
                  <dx-validator name="{{ 'tiers-entrepots-codePostal' | localize }}">
                    <dxi-validation-rule type="required"></dxi-validation-rule>
                    <dxi-validation-rule type="stringLength" max="9"></dxi-validation-rule>
                  </dx-validator>
                </dx-text-box>
              </div>
            </div>

            <!-- Ville -->
            <div class="dx-field">
              <div class="dx-field-label">{{ 'tiers-entrepots-ville' | localize }}</div>
              <div class="dx-field-value">
                <dx-text-box formControlName="ville" [readOnly]="readOnlyMode">
                  <dx-validator name="{{ 'tiers-entrepots-ville' | localize }}">
                    <dxi-validation-rule type="required"></dxi-validation-rule>
                    <dxi-validation-rule type="stringLength" max="35"></dxi-validation-rule>
                  </dx-validator>
                </dx-text-box>
              </div>
            </div>

            <!-- Pays -->
            <div class="dx-field">
              <div class="dx-field-label">{{ 'tiers-entrepots-pays' | localize }}</div>
              <div class="dx-field-value">
                <dx-select-box
                  formControlName="pays"
                  [readOnly]="readOnlyMode"
                  [dataSource]="pays"
                  displayExpr="description"
                  [searchEnabled]="true"
                  [searchExpr]="['id','description']"
                >
                  <dx-validator name="{{ 'tiers-entrepots-pays' | localize }}">
                    <dxi-validation-rule type="required"></dxi-validation-rule>
                  </dx-validator>
                </dx-select-box>
              </div>
            </div>
          </div>
        </div>
      </dxi-item>
      <dxi-item [ratio]="0.2">
      </dxi-item>
      <dxi-item [ratio]="4">
        <div class="dx-form-group dx-form-group-with-caption dx-card responsive-paddings">
          <span class="dx-form-group-caption">{{ 'tiers-entrepots-details-groupe-references' | localize }}</span>

          <div class="dx-form-group-content">

            <!-- Lieu fonction EAN Dépôt-->
            <div class="dx-field">
              <div class="dx-field-label">{{ 'tiers-entrepots-lieuFonctionEanDepot' | localize }}</div>
              <div class="dx-field-value">
                <dx-text-box formControlName="lieuFonctionEanDepot" [readOnly]="readOnlyMode">
                  <dx-validator name="{{ 'tiers-entrepots-lieuFonctionEanDepot' | localize }}">
                    <dxi-validation-rule type="stringLength" max="35"></dxi-validation-rule>
                  </dx-validator>
                </dx-text-box>
              </div>
            </div>

            <!-- Lieu fonction EAN Acheteur-->
            <div class="dx-field">
              <div class="dx-field-label">{{ 'tiers-entrepots-lieuFonctionEanAcheteur' | localize }}</div>
              <div class="dx-field-value">
                <dx-text-box formControlName="lieuFonctionEanAcheteur" [readOnly]="readOnlyMode">
                  <dx-validator name="{{ 'tiers-entrepots-lieuFonctionEanAcheteur' | localize }}">
                    <dxi-validation-rule type="stringLength" max="35"></dxi-validation-rule>
                  </dx-validator>
                </dx-text-box>
              </div>
            </div>

            <!-- Langue -->
            <div class="dx-field">
              <div class="dx-field-label">{{ 'tiers-entrepots-langue' | localize }}</div>
              <div class="dx-field-value">
                <dx-select-box
                  formControlName="langue"
                  [readOnly]="readOnlyMode"
                  [dataSource]="pays"
                  displayExpr="description"
                  [searchEnabled]="true"
                  [searchExpr]="['id','description']"
                >
                  <dx-validator name="{{ 'tiers-entrepots-langue' | localize }}">
                    <dxi-validation-rule type="required"></dxi-validation-rule>
                  </dx-validator>
                </dx-select-box>
              </div>
            </div>

            <!-- tvaCee -->
            <div class="dx-field">
              <div class="dx-field-label">{{ 'tiers-entrepots-tvaCee' | localize }}</div>
              <div class="dx-field-value">
                <dx-text-box formControlName="tvaCee" [readOnly]="readOnlyMode">
                  <dx-validator name="{{ 'tiers-entrepots-tvaCee' | localize }}">
                    <dxi-validation-rule type="stringLength" max="20"></dxi-validation-rule>
                  </dx-validator>
                </dx-text-box>
              </div>
            </div>
          </div>

          <!-- Type palette -->
          <div class="dx-field">
            <div class="dx-field-label">{{ 'tiers-entrepots-typePalette' | localize }}</div>
            <div class="dx-field-value">
              <dx-select-box
                formControlName="typePalette"
                [readOnly]="readOnlyMode"
                [dataSource]="typesPalette"
                displayExpr="description"
                [searchEnabled]="true"
                [searchExpr]="['id','description']"
              ></dx-select-box>
            </div>
          </div>

          <!-- Incoterm -->
          <div class="dx-field">
            <div class="dx-field-label">{{ 'tiers-entrepots-incoterm' | localize }}</div>
            <div class="dx-field-value">
              <dx-select-box
                formControlName="incoterm"
                [readOnly]="readOnlyMode"
                [dataSource]="incoterms"
                displayExpr="description"
                [searchEnabled]="true"
                [searchExpr]="['id','description']"
              ></dx-select-box>
            </div>
          </div>

          <!-- Indications sur facture -->
          <dx-accordion
            [collapsible]="true"
            [multiple]="false"
            [selectedIndex]="-1"
          >
            <dxi-item title="{{ 'tiers-entrepots-details-groupe-indicationFacture' | localize }}">

              <!-- Mention client facture -->
              <div class="dx-field">
                <div class="dx-field-label">{{ 'tiers-entrepots-mentionClientSurFacture' | localize }}</div>
                <div class="dx-field-value">
                  <dx-text-area formControlName="mentionClientSurFacture" [readOnly]="readOnlyMode">
                    <dx-validator name="{{ 'tiers-entrepots-mentionClientSurFacture' | localize }}">
                      <dxi-validation-rule type="stringLength" max="128"></dxi-validation-rule>
                    </dx-validator>
                  </dx-text-area>
                </div>
              </div>

            </dxi-item>

          </dx-accordion>

        </div>

        <!-- Infos commerciales -->
        <div class="dx-form-group dx-form-group-with-caption dx-card responsive-paddings">
          <span class="dx-form-group-caption">{{ 'tiers-entrepots-details-groupe-infocomm' | localize }}</span>

          <div class="dx-form-group-content">

            <!-- Regime Tva -->
            <div class="dx-field">
              <div class="dx-field-label">{{ 'tiers-entrepots-regimeTva' | localize }}</div>
              <div class="dx-field-value">
                <dx-select-box
                  formControlName="regimeTva"
                  [readOnly]="readOnlyMode"
                  [dataSource]="regimesTva"
                  displayExpr="description"
                  [searchEnabled]="true"
                  [searchExpr]="['id','description']"
                >
                <dx-validator name="{{ 'tiers-entrepots-regimeTva' | localize }}">
                  <dxi-validation-rule type="required"></dxi-validation-rule>
                </dx-validator>
                </dx-select-box>
              </div>
            </div>

            <!-- Type entrepot -->
            <div class="dx-field">
              <div class="dx-field-label">{{ 'tiers-entrepots-transporteur' | localize }}</div>
              <div class="dx-field-value">
                <dx-select-box
                  formControlName="transporteur"
                  [readOnly]="readOnlyMode"
                  [dataSource]="transporteurs"
                  displayExpr="raisonSocial"
                  [searchEnabled]="true"
                  [searchExpr]="['id','raisonSocial']"
                ></dx-select-box>
              </div>
            </div>

            <!-- Base tarif transport -->
            <div class="dx-field">
              <div class="dx-field-label">{{ 'tiers-entrepots-baseTarifTransport' | localize }}</div>
              <div class="dx-field-value">
                <dx-select-box
                  formControlName="baseTarifTransport"
                  [readOnly]="readOnlyMode"
                  [dataSource]="basesTarif"
                  displayExpr="description"
                  [searchEnabled]="true"
                  [searchExpr]="['id','description']"
                ></dx-select-box>
              </div>
            </div>

            <!-- PU Tarif transport -->
            <div class="dx-field">
              <div class="dx-field-label">{{ 'tiers-entrepots-prixUnitaireTarifTransport' | localize }}</div>
              <div class="dx-field-value">
                <dx-text-box formControlName="prixUnitaireTarifTransport" [readOnly]="readOnlyMode">
                  <dx-validator name="{{ 'tiers-entrepots-prixUnitaireTarifTransport' | localize }}">
                    <dxi-validation-rule type="numeric"></dxi-validation-rule>
                  </dx-validator>
                </dx-text-box>
              </div>
            </div>

            <!-- Type Camion -->
            <div class="dx-field">
              <div class="dx-field-label">{{ 'tiers-entrepots-typeCamion' | localize }}</div>
              <div class="dx-field-value">
                <dx-select-box
                  formControlName="typeCamion"
                  [readOnly]="readOnlyMode"
                  [dataSource]="typesCamion"
                  displayExpr="description"
                  [searchEnabled]="true"
                  [searchExpr]="['id','description']"
                ></dx-select-box>
              </div>
            </div>

            <!-- Transitaire -->
            <div class="dx-field">
              <div class="dx-field-label">{{ 'tiers-entrepots-transitaire' | localize }}</div>
              <div class="dx-field-value">
                <dx-select-box
                  formControlName="transitaire"
                  [readOnly]="readOnlyMode"
                  [dataSource]="transitaires"
                  displayExpr="raisonSocial"
                  [searchEnabled]="true"
                  [searchExpr]="['id','raisonSocial']"
                ></dx-select-box>
              </div>
            </div>

            <!-- Base tarif transit -->
            <div class="dx-field">
              <div class="dx-field-label">{{ 'tiers-entrepots-baseTarifTransit' | localize }}</div>
              <div class="dx-field-value">
                <dx-select-box
                  formControlName="baseTarifTransit"
                  [readOnly]="readOnlyMode"
                  [dataSource]="basesTarif"
                  displayExpr="description"
                  [searchEnabled]="true"
                  [searchExpr]="['id','description']"
                ></dx-select-box>
              </div>
            </div>

            <!-- PU tarif transit -->
            <div class="dx-field">
              <div class="dx-field-label">{{ 'tiers-entrepots-PUTarifTransit' | localize }}</div>
              <div class="dx-field-value">
                <dx-text-box formControlName="prixUnitaireTarifTransit" [readOnly]="readOnlyMode"></dx-text-box>
              </div>
            </div>

          </div>

          <!-- Autres infos commerciales -->
          <dx-accordion
            [collapsible]="true"
            [multiple]="false"
            [selectedIndex]="-1"
          >
            <dxi-item title="{{ 'tiers-entrepots-details-groupe-autres' | localize }}">

              <!-- gestionnaire CHEP -->
              <div class="dx-field">
                <div class="dx-field-label">{{ 'tiers-entrepots-gestionnaireChep' | localize }}</div>
                <div class="dx-field-value">
                  <dx-text-box formControlName="gestionnaireChep" [readOnly]="readOnlyMode">
                    <dx-validator name="{{ 'tiers-entrepots-gestionnaireChep' | localize }}">
                      <dxi-validation-rule type="stringLength" max="6"></dxi-validation-rule>
                    </dx-validator>
                  </dx-text-box>
                </div>
              </div>

              <!-- référence n° CHEP -->
              <div class="dx-field">
                <div class="dx-field-label">{{ 'tiers-entrepots-referenceChep' | localize }}</div>
                <div class="dx-field-value">
                  <dx-text-box formControlName="referenceChep" [readOnly]="readOnlyMode">
                    <dx-validator name="{{ 'tiers-entrepots-referenceChep' | localize }}">
                      <dxi-validation-rule type="stringLength" max="35"></dxi-validation-rule>
                    </dx-validator>
                  </dx-text-box>
                </div>
              </div>

              <!-- declaration EUR1 -->
              <div class="dx-field">
                <div class="dx-field-label">{{ 'tiers-entrepots-declarationEur1' | localize }}</div>
                <div class="dx-field-value">
                  <dx-check-box formControlName="declarationEur1" [readOnly]="readOnlyMode"></dx-check-box>
                </div>
              </div>

              <!-- Envoi auto détail -->
              <div class="dx-field">
                <div class="dx-field-label">{{ 'tiers-entrepots-envoieAutomatiqueDetail' | localize }}</div>
                <div class="dx-field-value">
                  <dx-check-box formControlName="envoieAutomatiqueDetail" [readOnly]="readOnlyMode"></dx-check-box>
                </div>
              </div>

              <!-- Contrôle réf client -->
              <div class="dx-field">
                <div class="dx-field-label">{{ 'tiers-entrepots-controlReferenceClient' | localize }}</div>
                <div class="dx-field-value">
                  <dx-text-box formControlName="controlReferenceClient" [readOnly]="readOnlyMode">
                    <dx-validator name="{{ 'tiers-entrepots-controlReferenceClient' | localize }}">
                      <dxi-validation-rule type="stringLength" max="50"></dxi-validation-rule>
                    </dx-validator>
                  </dx-text-box>
                </div>
              </div>

            </dxi-item>

          </dx-accordion>
        </div>
      </dxi-item>
    </dx-box>

    <dx-box direction="row">
      <dxi-item [ratio]="4">
        <div class="dx-form-group dx-form-group-with-caption dx-card responsive-paddings">
          <span class="dx-form-group-caption">{{ 'tiers-entrepots-instructionSecretaireCommercial' | localize }}</span>
          <div class="dx-form-group-content">
            <!-- Instructions secr comm -->
            <div class="dx-field">
              <div class="dx-field-value">
                <dx-text-area formControlName="instructionSecretaireCommercial" [readOnly]="readOnlyMode">
                  <dx-validator name="{{ 'tiers-entrepots-instructionSecretaireCommercial' | localize }}">
                    <dxi-validation-rule type="stringLength" max="140"></dxi-validation-rule>
                  </dx-validator>
                </dx-text-area>
              </div>
            </div>
          </div>
        </div>
      </dxi-item>
      <dxi-item [ratio]="0.2"></dxi-item>
      <dxi-item [ratio]="4">
        <div class="dx-form-group dx-form-group-with-caption dx-card responsive-paddings">
          <span
            class="dx-form-group-caption">{{ 'tiers-entrepots-instructionLogistique' | localize }}</span>
          <div class="dx-form-group-content">
            <!-- Instructions logistique -->
            <div class="dx-field">
              <div class="dx-field-value">
                <dx-text-area formControlName="instructionLogistique" [readOnly]="readOnlyMode">
                  <dx-validator name="{{ 'tiers-entrepots-instructionLogistique' | localize }}">
                    <dxi-validation-rule type="stringLength" max="280"></dxi-validation-rule>
                  </dx-validator>
                </dx-text-area>
              </div>
            </div>
          </div>
        </div>
      </dxi-item>
    </dx-box>

  </div>
</form>
<app-editing-alert></app-editing-alert>