<!-- LITIGES -->

<div
  *ngIf="noLitiges"
  class="nolitiges"
>
  {{ "ordres-litiges-noLitiges" | localize }}
  <div style="clear: both"></div>
  <dx-button
    type="default"
    class="create-litige-btn"
    [disabled]="!gridCdeHasRows"
    [focusStateEnabled]="false"
    text="{{ 'ordres-litiges-create' | localize }}"
    (onClick)="createLitige()"
  >
  </dx-button>
</div>
<br />
<form
  *ngIf="noLitiges !== null && noLitiges !== true"
  [formGroup]="formGroup"
>
  <div class="content-block form-litiges">
    <dx-box direction="row">
      <dxi-item [ratio]="5">
        <div class="dx-form-group">
          <dx-box direction="row">
            <dxi-item [ratio]="6">
              <div class="dx-form-group-content">
                <!-- Numéro -->
                <div class="dx-field field-large">
                  <div class="dx-field-label">
                    {{ "ordres-litiges-id" | localize }}
                  </div>
                  <div class="dx-field-value">
                    <dx-text-box
                      formControlName="id"
                      [readOnly]="true"
                    ></dx-text-box>
                  </div>
                </div>
                <!-- Avoir client -->
                <div class="dx-field field-large">
                  <div class="dx-field-label">
                    {{ "ordres-litiges-ordreAvoirClient" | localize }}
                  </div>
                  <div
                    class="dx-field-value"
                    formGroupName="ordreAvoirClient"
                  >
                    <dx-text-box
                      formControlName="numero"
                      [readOnly]="true"
                    ></dx-text-box>
                  </div>
                </div>
                <!-- Avoir fournisseur -->
                <div class="dx-field field-large">
                  <div class="dx-field-label">
                    {{ "ordres-litiges-ordreAvoirFournisseur" | localize }}
                  </div>

                  <div
                    class="dx-field-value"
                    formGroupName="ordreAvoirFournisseur"
                  >
                    <dx-text-box
                      formControlName="numero"
                      [readOnly]="true"
                    ></dx-text-box>
                  </div>
                </div>
              </div>
            </dxi-item>
            <dxi-item [ratio]="4">
              <!-- Date création -->
              <div class="dx-field">
                <div class="dx-field-label">&nbsp;</div>
                <div class="dx-field-value">
                  <dx-date-box
                    formControlName="dateCreation"
                    [readOnly]="true"
                  ></dx-date-box>
                </div>
              </div>
              <!-- Date avoir client-->
              <div class="dx-field">
                <div class="dx-field-label">&nbsp;</div>
                <div class="dx-field-value">
                  <dx-date-box
                    formControlName="dateAvoirClient"
                    [readOnly]="true"
                  ></dx-date-box>
                </div>
              </div>
              <!-- Date avoir fournisseur-->
              <div class="dx-field">
                <div class="dx-field-label">&nbsp;</div>
                <div class="dx-field-value">
                  <dx-date-box
                    formControlName="dateAvoirFournisseur"
                    [readOnly]="true"
                  ></dx-date-box>
                </div>
              </div>
            </dxi-item>
          </dx-box>
          <dx-box class="cloture-info cloture-box-adjust">
            <dxi-item [ratio]="4">
              <!--  Client Clôturé -->
              <div class="dx-field">
                <div class="dx-field-label checkbox-label">
                  {{ "ordres-litiges-clientCloture" | localize }}
                </div>
                <div class="dx-field-value">
                  <dx-check-box
                    class="thin-checkbox"
                    [readOnly]="true"
                    formControlName="clientCloture"
                  ></dx-check-box>
                </div>
              </div>
            </dxi-item>
            <dxi-item [ratio]="1"></dxi-item>
            <dxi-item [ratio]="4">
              <!-- OK Admin -->
              <div class="dx-field">
                <div class="dx-field-label checkbox-label">
                  {{ "ordres-litiges-clientValideAdmin" | localize }}
                </div>
                <div class="dx-field-value">
                  <dx-check-box
                    class="thin-checkbox"
                    [readOnly]="true"
                    formControlName="clientValideAdmin"
                  ></dx-check-box>
                </div>
              </div>
            </dxi-item>
          </dx-box>
          <dx-box class="cloture-info">
            <dxi-item [ratio]="4">
              <!-- Fournisseur Clôturé -->
              <div class="dx-field">
                <div class="dx-field-label checkbox-label">
                  {{ "ordres-litiges-fournisseurCloture" | localize }}
                </div>
                <div class="dx-field-value">
                  <dx-check-box
                    class="thin-checkbox"
                    [readOnly]="true"
                    formControlName="fournisseurCloture"
                  ></dx-check-box>
                </div>
              </div>
            </dxi-item>
            <dxi-item [ratio]="1"></dxi-item>
            <dxi-item [ratio]="4">
              <!-- OK Admin -->
              <div class="dx-field">
                <div class="dx-field-label checkbox-label">
                  {{ "ordres-litiges-fournisseurValideAdmin" | localize }}
                </div>
                <div class="dx-field-value">
                  <dx-check-box
                    class="thin-checkbox"
                    [readOnly]="true"
                    formControlName="fournisseurValideAdmin"
                  ></dx-check-box>
                </div>
              </div>
            </dxi-item>
          </dx-box>
          <dx-box direction="row">
            <dxi-item [ratio]="4">
              <!-- Réf Client-->
              <div class="dx-field">
                <div class="dx-field-label">
                  {{ "ordres-litiges-referenceClient" | localize }}
                </div>
                <div class="dx-field-value">
                  <dx-text-box formControlName="referenceClient"></dx-text-box>
                </div>
              </div>
            </dxi-item>
          </dx-box>
          <dx-box direction="row">
            <dxi-item [ratio]="4">
              <!-- Commentaires -->
              <div class="dx-field">
                <div class="dx-field-label">
                  {{ "ordres-litiges-commentairesInternes" | localize }}
                </div>
                <div class="dx-field-value">
                  <dx-text-box
                    formControlName="commentairesInternes"
                  ></dx-text-box>
                </div>
              </div>
            </dxi-item>
          </dx-box>
        </div>
      </dxi-item>
      <dxi-item [ratio]="0.4"></dxi-item>
      <dxi-item [ratio]="3">
        <dx-box>
          <dxi-item [ratio]="3.5">
            <div class="dx-form-group">
              <div class="dx-form-group-content">
                <!-- Avoir au client -->
                <div class="dx-field field-large">
                  <div class="dx-field-label">
                    {{ "ordres-litiges-avoirClient" | localize }}
                  </div>
                  <div class="dx-field-value">
                    <dx-number-box
                      formControlName="avoirClient"
                      [readOnly]="true"
                      [format]="{
                        type: 'currency',
                        currency: devise,
                        precision: 2
                      }"
                    >
                    </dx-number-box>
                  </div>
                </div>
                <!-- Remise sur facture -->
                <div
                  *ngIf="totalMontantRistourne"
                  class="dx-field field-large"
                >
                  <div class="dx-field-label">
                    {{ "ordres-litiges-totalMontantRistourne" | localize }}
                  </div>
                  <div class="dx-field-value">
                    <dx-number-box
                      formControlName="totalMontantRistourne"
                      [readOnly]="true"
                      [format]="{
                        type: 'currency',
                        currency: devise,
                        precision: 2
                      }"
                    >
                    </dx-number-box>
                  </div>
                </div>
                <!-- Dde avoir fourni -->
                <div class="dx-field field-large">
                  <div class="dx-field-label">
                    {{ "ordres-litiges-ddeAvoirFournisseur" | localize }}
                  </div>
                  <div class="dx-field-value">
                    <dx-number-box
                      formControlName="avoirFournisseur"
                      [readOnly]="true"
                      [format]="{
                        type: 'currency',
                        currency: devise,
                        precision: 2
                      }"
                    >
                    </dx-number-box>
                  </div>
                </div>
                <!-- fraisAnnexes -->
                <div class="dx-field field-large">
                  <div class="dx-field-label">
                    {{ "ordres-litiges-fraisAnnexes" | localize }}
                  </div>
                  <div class="dx-field-value">
                    <dx-number-box
                      formControlName="fraisAnnexes"
                      [readOnly]="true"
                      [format]="{
                        type: 'currency',
                        currency: devise,
                        precision: 2
                      }"
                    >
                    </dx-number-box>
                  </div>
                </div>
                <br />
                <!-- Résultat -->
                <div class="dx-field field-large border-top">
                  <div class="dx-field-label">
                    {{ "ordres-litiges-resultat" | localize }}
                  </div>
                  <div class="dx-field-value">
                    <dx-number-box
                      #resultat
                      [readOnly]="true"
                      [format]="{
                        type: 'currency',
                        currency: devise,
                        precision: 2
                      }"
                    >
                    </dx-number-box>
                  </div>
                </div>
                <br />
                <dx-button
                  class="btn-frais-annexes"
                  type="default"
                  [disabled]="litigeClosed && noFraisAnnexes"
                  [focusStateEnabled]="false"
                  text="{{
                    (litigeClosed
                      ? 'btn-fraisAnnnexes-visualiser'
                      : 'btn-fraisAnnnexes-ajout-visualiser'
                    ) | localize
                  }}"
                  (onClick)="fraisAnnexes()"
                ></dx-button>
              </div>
            </div>
          </dxi-item>
          <dxi-item [ratio]="0.4"></dxi-item>
          <dxi-item [ratio]="1.5">
            <div class="dx-form-group">
              <div class="dx-form-group-content">
                <!-- Avoir au client Taux-->
                <div class="dx-field field-small">
                  <div class="dx-field-label"></div>
                  <div class="dx-field-value">
                    <dx-number-box
                      formControlName="avoirClientTaux"
                      [readOnly]="true"
                      [format]="{
                        type: 'fixedPoint',
                        precision: 2
                      }"
                    >
                    </dx-number-box>
                  </div>
                </div>
                <!-- Remise sur facture Taux-->
                <div
                  *ngIf="totalMontantRistourne"
                  class="dx-field field-small"
                >
                  <div class="dx-field-label"></div>
                  <div class="dx-field-value">
                    <dx-number-box
                      formControlName="totalMontantRistourneTaux"
                      [readOnly]="true"
                      [format]="{
                        type: 'fixedPoint',
                        precision: 2
                      }"
                    >
                    </dx-number-box>
                  </div>
                </div>
                <!-- Dde avoir fourni Taux -->
                <div class="dx-field field-small">
                  <div class="dx-field-label"></div>
                  <div class="dx-field-value">
                    <dx-number-box
                      formControlName="avoirFournisseurTaux"
                      [readOnly]="true"
                      [format]="{
                        type: 'fixedPoint',
                        precision: 2
                      }"
                    >
                    </dx-number-box>
                  </div>
                </div>
              </div>
            </div>
          </dxi-item>
        </dx-box>
      </dxi-item>
      <dxi-item [ratio]="0.4"></dxi-item>
    </dx-box>
  </div>

  <div class="litige-btn-container">
    <dx-button
      type="default"
      text="{{ 'btn-saveLitige' | localize }}"
      [focusStateEnabled]="false"
      (onClick)="saveLitige()"
    ></dx-button>
    <dx-button
      type="normal"
      text="{{ 'btn-incidentLitige' | localize }}"
      [focusStateEnabled]="false"
      (onClick)="incidentLitige()"
    ></dx-button>
    <dx-button
      type="normal"
      text="{{ 'btn-avisResolution' | localize }}"
      [focusStateEnabled]="false"
      (onClick)="avisResolution()"
    ></dx-button>
    <dx-button
      type="normal"
      text="{{ 'btn-recapInterne' | localize }}"
      [focusStateEnabled]="false"
      (onClick)="recapInterne()"
    ></dx-button>
    <dx-button
      type="normal"
      text="{{ 'btn-creerLot' | localize }}"
      [focusStateEnabled]="false"
      (onClick)="creerLot()"
    ></dx-button>
    <dx-button
      type="normal"
      text="{{ 'btn-modifierLot' | localize }}"
      [focusStateEnabled]="false"
      [disabled]="!selectedLitigeLigneKey?.length"
      (onClick)="modifierLot()"
    ></dx-button>
    <dx-button
      type="success"
      text="{{ 'btn-close' | localize }}"
      [focusStateEnabled]="false"
      (onClick)="cloturer()"
    ></dx-button>
  </div>
</form>

<app-litige-cloture-popup
  [infosLitige]="infosLitige"
  (clotureChanged)="onClotureChanged()"
></app-litige-cloture-popup>

<app-frais-annexes-litige-popup
  [infosLitige]="infosLitige"
  (updateTotalFraisLitige)="showForm()"
></app-frais-annexes-litige-popup>

<app-selection-lignes-litige-popup
  [ordre]="currOrdre"
  [litigeID]="infosLitige?.litige.id"
  (selectedLignes)="assignLitigeLignes($event)"
></app-selection-lignes-litige-popup>

<app-gestion-operations-popup
  [ordre]="currOrdre"
  [infosLitige]="infosLitige"
  (updateFrais)="showForm()"
></app-gestion-operations-popup>

<app-confirmation-result-popup></app-confirmation-result-popup>
<app-documents-ordres-popup></app-documents-ordres-popup>
